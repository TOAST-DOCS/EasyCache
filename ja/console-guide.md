## Database > EasyCache > コンソール使用ガイド

## 始める

* 最初にやるべきことは、レプリケーショングループを作成することです。

## レプリケーショングループ
### レプリケーショングループ作成
* Console > Database > EasyCacheの**レプリケーショングループ**タブで作成ボタンを押すと、レプリケーショングループ作成ウィンドウが表示されます。

![rep_001.PNG](https://static.toastoven.net/prod_easycache/20.01.16/rep_create_001.PNG)

* 設定ウィンドウに表示された必須項目を全て入力し、下部の作成ボタンを押してください。
    * レプリケーショングループ名：レプリケーショングループの名前を入力します。
    * 説明：レプリケーショングループの説明を入力します。
    * サービスポート：RedisのPort番号を入力します。
        * 10000～12000の間で設定できます。
    * バージョン：作成するRedisのバージョンを選択します。
        * 現在3.2.12のみサポートしています。
    * インスタンスタイプ：レプリケーショングループの仕様を選択します。
    * Max Memory：Max Memoryを調整して、同期化やバックアップ実行時のメモリ不足を防止できます。
        * Redisサーバーに使用する最大のメモリ容量を変更できます。
        * 最大メモリ容量を柔軟に変更できるようにすることで、必要に応じて管理用メモリの容量も柔軟に確保できます。
    * アベイラビリティゾーン：レプリケーショングループが作成される領域を選択します。
    * 設定プロファイル：Redisの設定ファイルを選択します。
        * Defaultプロファイルを提供します。
        * 設定プロファイルを追加して選択できます。
    * VPC Subnet：private network通信を行いたいCompute & Networkサービスのsubnetを選択します。選択しない場合はDefault networkが設定されます。
    * 自動バックアップ設定：自動バックアップを行うかどうかを選択します。
        * バックアップ保存期間：1日から最大30日まで保存できます。
        * バックアップ開始時間：バックアップ開始時刻を指定します。30分単位で指定できます。
        * バックアップ所要時間：バックアップ開始時刻から指定した時間までの任意の時点から開始します。1時間～最大3時間まで指定可能です。
    * 入力し、**作成**ボタンを押します。
    * 確認画面で入力した内容を確認します。
    * 最後に**作成**ボタンを押します。
    * レプリケーショングループが作成されると、Masterノードが作成されます。
    * 作成されるまで数分かかります。
    
### レプリケーション(ノード追加)

* 可用性を高めるために、RedisがサポートするReplicaノードを作成できます。
* Replicaノードを作成するには、原本レプリケーショングループを選択した後、ノード追加ボタンを押します。

![nod_ad_001.PNG](https://static.toastoven.net/prod_easycache/20.01.16/rep_node_add_001.PNG)

* Replicaノードが作成されるアベイラビリティーゾーンを選択できます。原本Masterノードとは別のアベイラビリティーゾーンを選択することを推奨します。
* Masterノードの情報を確認、参照できます。
* OKボタンを押すとReplicaノードが作成されます。
* 作成されたノードの情報は、レプリケーショングループ> [ノード情報]で確認できます。
* 作成時、自動的に複製関係が設定されます。
* Replicaノードは原本Masterノードと同じサーバー仕様です。
* 原本Masterノードのサイズに比例して、Replicaノードの作成時間が長くなる場合があります。

##### 制約事項
* 原本Masterノードは1個のReplicaノードのみ作成できます。
* ReplicaノードのReplicaノードは作成できません。

#### 高可用性(HA)
* standaloneのMasterノードにReplicaノードを追加すると、自動的に高可用性の機能が設定されます。
* Masterノードを監視して障害が発生した時、自動的にフェイルオーバーを行うことにより、downtimeを最小限にできます。
* フェイルオーバーとは、障害が発生したMasterノードを検知して、自動的にReplicaノードをMasterノードに昇格(failover)させる処理のことです。
* Master、Replicaノードの障害および状態に関するイベントを確認できます。

##### 制約事項
* Replicaノード追加時、HA設定が失敗するとレプリケーショングループ> [基本情報]でHA再設定ボタンを押してHAを再設定できます。

![rep_ha_error_001.PNG](https://static.toastoven.net/prod_easycache/20.01.16/rep_ha_error_001.PNG)

* 障害が発生してフェイルオーバーを行った場合は、障害が発生した既存Masterノードは停止します。障害が発生したノードを削除すると、高可用性機能を使用しない一般standaloneのMasterノードに変更されます。
* またstandaloneになったMasterノードにReplicaノードを追加すると、高可用性機能を再度新たに指定して使用できます。
* 変更された新Masterノードは、既存Masterノードの接続に使用されるドメインを継承します。
* フェイルオーバーを実行した既存のMasterノードは「利用不可」状態になり、利用不可状態では新masterノードにのみ高可用性機能が提供されません。

### レプリケーショングループの修正
* 原本レプリケーショングループを選択し、**修正**ボタンを押します。
    * レプリケーショングループ名：レプリケーショングループ名を変更できます。
    * 説明：レプリケーショングループの説明を変更できます。
    * 設定プロファイル：Redis設定を変更できます。
    * Max Memory：使用する最大メモリ容量を変更できます。
    * 自動バックアップ設定：自動バックアップを使用するかどうかを選択します。
        * バックアップ保存期間：1日から最大30日まで保存可能です。
        * バックアップ開始時間：バックアップ開始時刻を指定します。30分単位で指定可能です。
        * バックアップ所要時間：バックアップ開始時刻から指定した時間までの任意の時点で開始します。1時間から最大3時間まで指定可能です。

![rep_mo_001.PNG](https://static.toastoven.net/prod_easycache/20.01.16/rep_modify_001.PNG)

* 変更内容を確認し、**変更**ボタンを押します。
* 一度設定したサービスポート、Redisバージョン、インスタンスタイプ、アベイラビリティゾーンは変更できません。

### 自動バックアップ

* 毎日1回、指定された時間に自動的にメモリデータ(RDBファイル)をバックアップします。
* 作成された自動バックアップはバックアップタブで管理できます。
* バックアップ対象になったレプリケーショングループが削除されると、バックアップファイルも削除されます。
* 指定されたバックアップ保存期間が過ぎると、バックアップファイルは自動的に削除されます。
* 自動バックアップは、バックアップ開始時刻からバックアップ所要時間までの任意の時点に始まります。

### 手動バックアップ作成
* レプリケーショングループのバックアップを、必要な時にすぐに作成できます。
* バックアップ対象になったレプリケーショングループを削除しても、手動バックアップファイルは削除されません。
* 作成された手動バックアップは、バックアップタブで管理できます。
* バックアップの実行中は、バックアップによる性能の低下が発生する場合があります。
* 定められたバックアップ保存期間が過ぎると、バックアップファイルは自動的に削除されます。
* バックアップ対象のレプリケーショングループが削除されると、基本情報にレプリケーショングループの詳細内容は表示されません。

![manual_backup_001.png](https://static.toastoven.net/prod_easycache/20.01.16/rep_manual_backup_001.PNG)

* 手動バックアップファイルを作成するために、対象レプリケーショングループを選択した後、**手動**バックアップボタンを押します。
    * バックアップ名：バックアップの名前を入力します。
    * 説明：バックアップの説明を入力します。
    * バックアップ保存期間：削除しない限り、1日～最大30日まで保管可能です。

* OKボタンを押すと、手動バックアップが作成されます。
* データサイズに比例してバックアップの作成時間が長くなる場合があります。

##### 制約事項
* 手動バックアップの実行中は、重複して手動バックアップを行えません。進行中の手動バックアップが完了してから再度試行してください。
* 自動バックアップ時間に手動バックアップを行う場合、手動バックアップがすぐに作成されず、遅延する場合があります。

### レプリケーショングループの詳細
*レプリケーショングループの詳細情報を確認できます。
    * 基本情報
    * 接続情報
    * ノード情報
    * モニタリング

#### 基本情報
* 作成されたレプリケーショングループを選択し、**基本情報**タブを押します。
* レプリケーショングループの詳細情報を確認できます。

![rep_detail_001.PNG](https://static.toastoven.net/prod_easycache/20.01.16/rep_detail_info_001.PNG)

* 確認可能な項目は下記のとおりです。
    * レプリケーショングループ名
    * 説明
    * タイプ
    * バージョン
    * サービスポート
    * インスタンスタイプ
    * Max Memory
    * アベイラビリティゾーン
    * 設定プロファイル
    * VPC Subnet
    * 作成日
    * 自動バックアップ設定
        
#### レプリケーショングループ接続

* 作成されたレプリケーショングループを選択し、接続情報タブを押します。

![rep_de_002.PNG](https://static.toastoven.net/prod_easycache/20.01.16/rep_connection_info_001.PNG)

* 暗号化されたパスワードは表示ボタンを押すと確認できます。
* コピーボタンを押すと、パスワードをコピーできます。
* 接続可能なドメイン情報を確認できます。
* Floating IPを接続していないRedisノードは、外部からアクセスできません。
* Floating IP接続を行う場合は、公認ドメインが発行されます。
* コピーボタンを押すとドメインをコピーできます。
* 接続情報は、同じVPC Subnetに接続されたノードのアプリケーションで使用できます。
* コマンドは、同じVPC Subnetに接続されたノードで実行可能です。
    * **自分のIP表示**：ローカルIPがCIDR形式で表示されます。
    * **作成**ボタンを押すと登録されます。
    * 接続制御情報に登録されていないIPは接続できません。
    
#### ノード情報
* 作成されたレプリケーショングループを選択し、ノード情報タブを押します。
* レプリケーショングループのノードの詳細情報を確認できます。

![rep_node_info_001.PNG](https://static.toastoven.net/prod_easycache/20.01.16/rep_node_info_001.PNG)

* 確認可能な項目は下記のとおりです。
    * ノード名
    * 種類
    * IP
    * アベイラビリティゾーン
    * 作成日
    * 状態

#### モニタリング
* 作成されたレプリケーショングループを選択し、モニタリングタブを押します。
* EasyCacheはRedisの運営および使用に必要なモニタリング項目を周期的に収集し、チャートを表示します。
* 特定レプリケーショングループのモニタリング項目を確認したい場合は、レプリケーショングループリストで特定レプリケーショングループを選択し、Monitoringタブを選択します。

![monitoring_001.png](https://static.toastoven.net/prod_easycache/20.01.16/rep_monitoring_info_001.PNG)

* チャートの種類は平均値をサポートします。
* 1時間、 24時間などのボタンを押すごとに、現在時刻を基準に計算して更新します。
    * 1時間ボタンは1分ごとに収集した情報のチャートを表示します。
    * 24時間ボタンは1時間収集した情報のチャートを表示します。
    * 1週間ボタンは24時間収集した情報のチャートを表示します。
    * 1か月ボタンは1週間収集した情報のチャートを表示します。
* 指定ボタンを押して直接検索期間を指定できます。
* モニタリングデータの保存期間は1か月です。
* モニタリング項目
    * CPU利用率
    * システムメモリ
    * 接続したクライアント
    * ブロックしたクライアント
    * Redisメモリ使用量
    * Redisメモリ使用量(rss)
    * メモリ断片化比率
    * 秒に処理したコマンド数
    * 入力バイト
    * 出力バイト
    * 削除されたキー数(expired)
    * 削除されたキー数(evicted)
    * 照会成功数
    * 照会失敗数
    * 照会成功率
    * キーの個数
    * get実行回数
    * get usec/get calls
    * set実行回数
    * set usec/get calls
* モニタリング項目は、フィルタ条件で表示したい項目だけを選択できます。

![filter_001.PNG](https://static.toastoven.net/prod_easycache/20.01.16/rep_monitoring_info_002.PNG)
      
## バックアップ

![backup_001.PNG](https://static.toastoven.net/prod_easycache/20.01.16/backup_001.PNG)

* EasyCache > バックアップタブを選択します。
* バックアップファイルを1つまたは複数選択して削除できます。
* バックアップの実行中は、バックアップによる性能低下が発生する場合があります。
* サービスに影響を与えないように、サービスの負荷が少ない時間にバックアップを行うことを推奨します。
* 検索ワード欄にバックアップ名またはレプリケーショングループ名の単語を入力して検索すると、検索結果が表示されます。
* 更新を利用し、バックアップファイルリストを更新して情報を確認できます。

![backup_002.PNG](https://static.toastoven.net/prod_easycache/20.01.16/backup_002.PNG)

* 基本情報でバックアップファイルの詳細内容とレプリケーショングループの詳細内容を確認できます。
* バックアップ
    * バックアップ名
    * 説明
    * バックアップタイプ
    * キャッシュサイズ
    * バックアップファイルサイズ
    * バックアップ保存期間
    * バックアップ最終保存日
    * 状態
    * バックアップ開始日時
* レプリケーショングループ
    * レプリケーショングループ名
    * インスタンスタイプ
    * バージョン
    * Max Memory
    * サービスポート
    * VPC Subnet
    
### 復元

* バックアップファイルを選択し、[レプリケーショングループ復元]を押します。
* 保存されたバックアップファイルを利用して、メモリデータを復元できます。
* 復元時に原本ノードを変更しないで、同じ仕様のノードを新たに作成します。
* 復元時に原本ノードを変更しないで、異なる仕様のノードを新たに作成します。

![restore_001.PNG](https://static.toastoven.net/prod_easycache/20.01.16/backup_003.PNG)

* 復元内容
    * バックアップ名：復元するバックアップファイル名
    * レプリケーショングループ名：レプリケーショングループの名前を入力します。
    * 説明：レプリケーショングループの説明を入力します。
    * サービスポート：バックアップ対象になったレプリケーショングループのポートが表示されます。
        * RedisのPort番号を変更できます。
        * 10000～12000の間で設定できます。
    * バージョン：バックアップ対象になったレプリケーショングループのRedisバージョンが表示されます。
        * 現在3.2.12のみサポートしています。
    * インスタンスタイプ：バックアップ対象になったレプリケーショングループの仕様が表示されます。
        * バックアップのキャッシュサイズより大きいインスタントタイプのみ表示されます。
        * インスタントタイプを変更できます。
    * Max Memory：Max Memoryを調整して、同期化やバックアップ実行時のメモリ不足を防止できます。
        * Redisサーバーに使用する最大メモリ容量を変更できます。
        * 最大メモリ容量を柔軟に変更できるようにすることで、必要に応じて管理用メモリの容量も柔軟に確保できます。
    * アベイラビリティゾーン：レプリケーショングループが作成される領域を選択します。
    * 設定プロファイル：バックアップ対象になったレプリケーショングループのRedisの設定ファイルが表示されます。
        * 設定プロファイルを追加して変更できます。
    * VPC Subnet：バックアップ対象になったレプリケーショングループのVPC Subnetが表示されます。
        * private network通信を行いたいCompute & Networkサービスのsubnetを選択できます。
    * 自動バックアップ設定：自動バックアップを行うかどうかを選択します。
        * バックアップ保存期間：1日から最大30日まで保存可能です。
        * バックアップ開始時間：バックアップ開始時刻を指定します。30分単位で指定可能です。
        * バックアップ遅延時間：バックアップ開始時刻から指定した時間の間の任意の時点に開始します。 3時間まで指定可能です。
    * 入力し、作成ボタンを押します。
    * 作成されたレプリケーショングループは、レプリケーショングループタブで確認できます。

## 設定プロファイル

### 設定プロファイル作成
* EasyCacheは変更が可能なRedisの設定をプロファイル形式で登録して管理できます。
* 変更が可能なRedisの設定をプロファイルに登録するために、**プロファイル設定**タブを選択した後、作成ボタンを押します。

![pro_002.PNG](https://static.toastoven.net/prod_easycache/20.01.16/profile_001.PNG)

    * プロファイル名：プロファイル名を入力します。
    * 説明：プロファイルの説明を入力します。
* 項目値を入力し、OKボタンを押します。
* 登録したプロファイル情報を修正します。
    * 利用中のノードにも反映されます。
* 登録したプロファイルを削除します。
    * 利用中のノードがあるプロファイルは削除できません。
* 基本設定情報があるDefaultプロファイルを提供します。
* Defaultプロファイルは修正、削除できません。
* プロファイルの状態を確認できます。
    * 正常
        * プロファイルを修正、削除できます。
    * 変更適用中
        * プロファイルを変更し、変更内容を各ノードに配信中の状態です。
        * 変更内容の配信が終わると、状態は正常に変更されます。
        * 変更中状態ではレプリケーショングループの作成、修正、削除ができません。
    * 利用中
        * プロファイルを利用して作成、変更中のレプリケーショングループがある状態です。
        * レプリケーショングループの作成完了後、状態は正常に変更されます。
        * プロファイルが利用中の状態では、プロファイルの作成、修正はできません。
        
### プロファイル詳細

![profile_detail_001.PNG](https://static.toastoven.net/prod_easycache/20.01.16/profile_002.PNG)
 
* プロファイルの詳細情報を確認できます。
    * 項目名
    * 記入例：項目の入力例
    * 項目値：実際に設定された値
    * 説明：項目の説明
* 프로파일 항목
    * hash-max-ziplist-entries
    * hash-max-ziplist-value	
    * latency-monitor-threshold
    * list-compress-depth	
    * list-max-ziplist-size	
    * maxmemory-policy	
    * maxmemory-samples	
    * set-max-intset-entries	
    * slowlog-log-slower-than	
    * slowlog-max-len		
    * tcp-keepalive	
    * timeout	
    * zset-max-ziplist-entries
    * zset-max-ziplist-value
    
## アラーム

* EasyCacheは、指定したリソースで発生する特定イベントに対する通知を受信グループに伝達できます。

![eve_001.PNG](https://static.toastoven.net/prod_easycache/20.01.16/alram_001.PNG)

### アラームルール

![eve_001.PNG](https://static.toastoven.net/prod_easycache/20.01.16/alram_002.PNG)

* アラームを発生させる条件と対象、受信グループを指定して作成するアラームのトリガーです。
* 通知を設定するには、通知タブを選択した後、アラームルール作成ボタンを押します。
* アラームルールにはアラーム発生条件とアラームを受信する受信グループを指定します。
    * アラームの発生条件にはマトリックス条件とイベント条件の2つがあります。
        * マトリックス条件：キャッシュインスタンスで収集した各種性能指標値(モニタリング項目参照)を利用してアラーム条件を指定し、下記のような条件を指定できます。
            * マトリックス名
            * 演算子
            * 集計の種類
            * 評価の頻度
            * しきい値
        * イベント条件：サービス内で発生するすべてのイベントの中から、アラームを受信したいイベント(イベント項目参照)を指定できます。
    * 受信グループは、別途のダイアログで確認、追加できます。
    * 作成したアラームルールは、基本的にはすべてのレプリケーショングループが対象ですが、対象レプリケーショングループを指定して特定レプリケーショングループ用のアラームルールを作成できます。
    * 設定後、OKボタンをクリックします。
* 作成したアラームルールは、アラーム機能を「使用しない」に変更して一時的にアラームを停止できます。

### 受信グループ

![not_re_001.PNG](https://static.toastoven.net/prod_easycache/20.01.16/alram_003.PNG)

* 通知を受け取る受信者のグループを作成して管理できます。
* 受信グループを確認するには、アラームルール一覧、またはアラームルール作成、変更画面の受信グループ一覧ボタンを押します。
* 受信グループを作成するには、受信グループ一覧で受信グループ作成ボタンを押します。
* 受信グループで指定できる受信者は、プロジェクトメンバーだけです。
    * TOAST会員情報に登録したEmail、電話番号にEmail、SMSを送信できます。
    * SMSは簡単なアラームのみ送ります。SMSを選択する場合は詳しいアラーム内容をご確認するためにEmailを追加してください。
* アラームルールで使用中の受信グループを削除すると、アラームルールからも削除されるため、他の受信グループがないアラームルールの場合、今後はアラームを送らなくなるため、注意が必要です。

##### 制約事項
* アラームルールの対象レプリケーショングループにレプリケーショングループを1つだけ入力し、そのレプリケーショングループをレプリケーショングループ画面から削除した場合、アラームは唯一の対象レプリケーショングループがなくなった関係で、今後はすべてのレプリケーショングループを対象として認識します。
* アラームルールの受信グループに受信グループを1つだけ入力し、その受信グループを受信グループ詳細画面から削除した場合、アラームは唯一の受信グループがなくなった関係で今後はアラームを送れなくなります。
* レプリケーショングループ作成のアラームは、対象レプリケーショングループがあってもすべてのレプリケーショングループが対象になりアラームを送ります。

## イベント

* EasyCache > イベントタブを選択します。
* EasyCacheは、レプリケーショングループで発生した意味のあるイベントを自動的に記録します。
* 検索ワード欄に単語を入力して検索すると、イベントのリソース名と説明を対象に検索結果を表示します。

![eve_002.PNG](https://static.toastoven.net/prod_easycache/20.01.16/event_001.PNG)

* 時間、日別に検索できます。
* イベントデータの保存期間は1か月です。
* イベントタイプは、どのリソースで発生したイベントなのかを指します。
    * ALL：NODEとREPLICATION_GROUP関連のイベントです。
    * NODE：NODEに関連するイベントです。
    * REPLICATION_GROUP: REPLICATION_GROUPに関連するイベントです。
    * FROFILE：FROFILEに関連するイベントです。

##### イベント項目
##### レプリケーショングループ関連イベント
* レプリケーショングループ
  * 削除
     * 開始
     * 失敗
     * 終了
  * 作成
     * 開始
     * 失敗
     * 終了
  * 修正
     * 開始
     * 失敗
     * 終了
  * 再起動
     * 開始
     * 失敗
     * 終了
* Floating IP
  * 接続
     * 開始
     * 失敗
     * 終了
  * 解除
     * 開始
     * 失敗
     * 終了
* キャッシュインスタンス
  * 接続
     * 成功
     * 失敗
        
##### ノード関連イベント
* ノード
  * 削除
    * 開始
    * 失敗
    * 終了
  * 追加
    * 開始
    * 失敗
    * 終了
  * 状態
    * 無効化済
    * 有効化済
##### プロファイル関連イベント
* プロファイル
  * 修正
    * 開始
    * 失敗
    * 終了
##### 自動HA関連イベント
* HA
  * 削除 
     * 開始
     * 終了
  * 設定 
     * 開始
     * 失敗
     * 終了
* failover 
    * 成功
##### バックアップ関連イベント
* 手動バックアップ
    * 開始
    * 失敗
    * 終了
* 自動バックアップ
    * 開始
    * 失敗
    * 終了
